---
tags:
  - OpenAPI
  - Hono
  - APIドキュメント
  - 開発計画
type: 開発計画
status: 計画中
created: 2025-07-24
updated: 2025-07-24
---

# HonoにOpenAPIの仕組みを導入

> [!info] 目的
> [[Hono]]アプリケーションにOpenAPI（Swagger/OAS）の仕組みを導入し、APIドキュメントの自動生成と管理を可能にする。
> 現在、APIのエンドポイントが増えるにつれて、手動でのドキュメント更新が負担になっている。OpenAPIを導入することで、開発効率の向上とドキュメントの正確性を保つことを目指す。

## 提案内容

- [[Hono]]アプリケーションに**`@hono/zod-openapi` を用いて**OpenAPI仕様を記述し、APIドキュメントを自動生成する仕組みを導入する。
- 既存のAPIエンドポイントに対して[[Zod]]スキーマを用いたOpenAPIのスキーマ定義を追加する。
- APIドキュメントを自動生成し、開発者が容易に参照できる環境を構築する。

## 考慮事項

- `@hono/zod-openapi` の導入による既存のAPI定義への影響を最小限に抑える方法を検討する。
- CI/CDパイプラインへのOpenAPIドキュメント生成プロセスの組み込みを検討する。

## 🚀 実装計画

> [!tip] 概要
> [[Hono]]アプリケーションにOpenAPIの仕組みを導入するための具体的な実装計画。

### 🏗️ フェーズ1: ライブラリ選定と基本導入

> [!warning] 実装予定内容
> - **OpenAPIライブラリの選定**: [[Hono]]と[[Zod]]を組み合わせた`@hono/zod-openapi`を採用する。これにより、型安全なスキーマ定義とOpenAPIドキュメントの自動生成をシームレスに行う。
> - **ライブラリのインストールと設定**: `zod`と`@hono/zod-openapi`を`packages/api`プロジェクトにインストールする。`packages/api/src/index.ts`または適切な場所で、OpenAPIドキュメントを生成・提供するための基本的な設定を行う。具体的には、`OpenAPIHono`インスタンスの作成と、Swagger UIのミドルウェアの組み込みを行う。

### 📦 フェーズ2: スキーマ定義とドキュメント生成

> [!warning] 実装予定内容
> - **Zodスキーマの定義**:
>   - `packages/api/src/routes/auth.ts` 内の各エンドポイント（例: ログイン、ユーザー登録）に対して、リクエストボディ、クエリパラメータ、パスパラメータ、レスポンス（成功時、エラー時）のZodスキーマを定義する。
>   - 共通で利用するスキーマ（例: エラーレスポンスのフォーマット）は、`packages/api/src/utils/schemas.ts` のような共通ファイルに定義することを検討する。
> - **`@hono/zod-openapi` を用いたルート定義**:
>   - 定義したZodスキーマを`@hono/zod-openapi` の`createRoute`関数や`openapi`ミドルウェアと連携させ、Honoのルートに組み込む。
>   - 各ルートに対して、`summary`, `description`, `tags` などのOpenAPIメタデータを追加し、ドキュメントの可読性を高める。
> - **OpenAPIドキュメントの生成と提供**:
>   - `packages/api/src/index.ts` にて、`OpenAPIHono`インスタンスからOpenAPI JSON/YAMLを生成するエンドポイント（例: `/openapi.json`）を設定する。
>   - `hono-swagger-ui` などのライブラリを利用し、Swagger UIを`/docs`パスで提供する設定を追加する。

### ✅ フェーズ3: 検証と改善

> [!warning] 実装予定内容
> - **生成されたドキュメントの検証**:
>   - Swagger UIにアクセスし、生成されたAPIドキュメントが期待通りに表示され、各エンドポイントのスキーマが正確に反映されていることを確認する。
>   - 実際にAPIリクエストを送信し、ドキュメントと実際のAPIの挙動に乖離がないかを確認する。
> - **エラーハンドリングとバリデーションの統合**:
>   - `@hono/zod-openapi` によるリクエストバリデーションが正しく機能し、不正なリクエストに対して適切なエラーレスポンスが返されることを確認する。
>   - エラーレスポンスのスキーマがOpenAPIドキュメントに適切に記述されていることを確認する。
> - **CI/CDへの組み込み（オプション）**:
>   - OpenAPIドキュメントの生成コマンドをCI/CDパイプラインに組み込み、APIの変更時に自動的にドキュメントが更新されるようにする。
>   - ドキュメントの整合性チェック（例: linting）をCI/CDに追加することを検討する。

## 🎯 完了基準

> [!success] 完了項目
> - [[Hono]]アプリケーションがOpenAPIドキュメントを生成し、提供できること。
> - 主要なAPIエンドポイント（認証、管理）のスキーマがOpenAPIドキュメントに正確に反映されていること。
> - 開発者が生成されたドキュメントを容易に参照できること。